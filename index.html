<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <title>Nueva Place</title>
        <link href="./default_styles.css" rel="stylesheet">
        <link href="./style.css" rel="stylesheet">
    </head>
    <body class = "disable-transitions">
        <a id="logo" href="#link-to-the-homepage"><div></div>/Place</a>
        <!-- <header> -->
            <!-- <h1>Nueva Place</h1> -->
            <!-- <div id="sign-in-wrapper">
                <a href="/sign-in/" class="button button-primary">Sign in with Google</a> to contribute
            </div> -->
        <!-- </header> -->
        <main>
            <div id="canvas-wrapper">
                <canvas id="canvas"></canvas>
            </div>
            <div id="controls">
                <div id="color-buttons">
                    <button id="exit-place-mode" class="button-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>
                    </button>
                    <div id="cooldown"></div>
                </div>
            </div>
        </main>
        <div id="account-wrapper">
            <button id="sign-in" class="button-primary">Google Sign In</button>
            <button id="profile-img" class="button-secondary"></button>
            <div id="menu">
                <div id="account-email">
                    cheese@cheese.com
                </div>
                <button id="sign-out" class="button-secondary">Sign Out</button>
            </div>
        </div>
    </body>
        <!-- GOOGLE SIGN IN -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
      
        const firebaseConfig = {
          apiKey: "AIzaSyCFyU3lKCbyZYnrqSDNQZ2WjQA8gYhWKkA",
          authDomain: "nueva-place.firebaseapp.com",
          projectId: "nueva-place",
          storageBucket: "nueva-place.appspot.com",
          messagingSenderId: "888072535263",
          appId: "1:888072535263:web:41d224e58b2f2ec1eefd6a",
          measurementId: "G-CHM59EXZ90"
        };
      
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
      
        // SIGN IN
        document.getElementById("sign-in").addEventListener("click", () => {
          signInWithPopup(auth, provider).then(result => {
            const user = result.user;
            if (!user.email.endsWith("@nuevaschool.org")) {
              alert("You must use a @nuevaschool.org email address.");
              signOut(auth);
              return;
            }
            showUser(user.email);
          });
        });
        
        //SIGN OUT
        document.getElementById("sign-out").addEventListener("click", () => {
          signOut(auth).then(() => {
            hideUser();
          });
        });
      
        onAuthStateChanged(auth, user => {
          if (user && user.email.endsWith("@nueva.place")) {
            showUser(user.email);
          } else {
            hideUser();
          }
        });
      
        function showUser(email) {
          document.getElementById("profile-img").textContent = email;
          document.getElementById("profile-img").style.display = "block";
          document.getElementById("sign-in").style.display = "none";
          document.getElementById("sign-out").style.display = "inline-block";
          signedIn = true;
        }
      
        function hideUser() {
          document.getElementById("profile-img").style.display = "none";
          document.getElementById("sign-in").style.display = "block";
          document.getElementById("sign-out").style.display = "none";
          signedIn = false;
        }

      </script>
        <!-- END GOOGLE SIGN IN -->
    <script src="./script.js"></script>
</html>
